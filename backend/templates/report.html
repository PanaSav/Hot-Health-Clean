<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Hot Health — Report</title>
  <link rel="stylesheet" href="/styles.css"/>
</head>
<body>
  <header><h1>Hot Health — Report</h1></header>
  <main class="wrap">
    <section class="card">
      <h2>Report</h2>

      <div class="row">
        <div class="linkbox" id="linkBox">{{self_url}}</div>
        <div class="actions">
          {{back_link}}
          <button class="btn-primary" onclick="window.print()">🖨️ Print</button>
          <button class="btn-aqua" id="copyBtn">📋 Copy Link</button>
        </div>
      </div>

      {{#translate_picker}}
      <div class="row">{{translate_picker}}</div>
      {{/translate_picker}}

      <div class="row">
        <div class="grid" style="width:100%">
          <div class="block">
            <div class="kvs">
              <p><b>Created:</b> {{created}}</p>
              <p><b>Patient:</b> {{patient_name}} {{blood_type_badge}}</p>
              <p><b>Email:</b> {{patient_email_link}}</p>
              <p><b>Emergency:</b> {{emer_line}}</p>
            </div>
            <hr/>

            <h3>Transcript</h3>
            <div class="dual">
              <div class="panel">
                <h4>Original {{detected_lang_tag}}</h4>
                <pre>{{transcript}}</pre>
              </div>
              <div class="panel">
                <h4>Translated {{target_lang_tag}}</h4>
                <pre>{{translated}}</pre>
              </div>
            </div>

            <hr/>
            <h3>Key Facts</h3>
            <div class="kf-list">
              <h4>Medications</h4>
              {{meds_block}}
              <h4>Allergies</h4>
              {{allergies_block}}
              <h4>Conditions</h4>
              {{conditions_block}}
              <h4>Vitals</h4>
              {{vitals_block}}
            </div>
          </div>

          <div class="block">
            <h3>QR Code</h3>
            <div class="qrbox">
              <img alt="QR to this report" src="{{qr_src}}"/>
            </div>
            <p class="muted" style="margin-top:8px">Scan with a phone to open this report.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    (function(){
      const btn = document.getElementById('copyBtn');
      const box = document.getElementById('linkBox');
      btn?.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(box.textContent.trim());
          btn.textContent = '✅ Copied!';
          setTimeout(()=> btn.textContent='📋 Copy Link', 1200);
        } catch {
          btn.textContent = '❌ Copy failed';
          setTimeout(()=> btn.textContent='📋 Copy Link', 1200);
        }
      });
    })();
  </script>
</body>
</html>
